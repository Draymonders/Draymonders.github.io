# 数据库

## 事务特性

数据库四个特性`ACID`, 分别是原子性，一致性，隔离性，持久性。

## 事务隔离级别

- uncommitted 读未提交，会导致脏读，不可重复读，幻读
- read commited 读已提交，会导致不可重复读，幻读
- repeat read 可重复读，会导致幻读
- serialization 串行读

mysql的`InnoDB`引擎实现的`repeat read`，是由`MVCC`+`nextKey lock`组成的
**不会出现幻读的情况**(`gap lock`间隙锁，在行记录的索引之前和之后也加了锁，不能插入)
    * MVCC解决事务并发修改和删除
    * gap lock解决事务并发的新增

## 两段锁协议

X为独占锁，S为共享锁

- 事务 T 要修改数据 A 时必须加 X 锁，直到 T 结束才释放锁。
- 在一级的基础上，要求读取数据 A 时必须加 S 锁，读取完马上释放 S 锁。

## 3范式
- 1NF: 属性不可分。
- 2NF: 每个非主属性完全函数依赖于键码。
- 3NF: 非主属性不传递函数，全部依赖于键码。

## 分库分表

- 网络带宽不足 -> 分库
- IO压力大 -> 分库分表

## 连接和子查询

- 子查询需要建临时表(多了创建，删除过程)
- 连接是笛卡尔积，可以通过索引关联去优化，如果没索引，效率其实也不高